<?xml version="1.0" encoding="UTF-8"?>
<odoo >
<template id="sale_report_inherit" inherit_id="sale.report_saleorder_document" >

    <xpath expr="//h2[@class='mt16']" position="replace">
        <!-- <style>
            body {
                direction: rtl;
            }
        </style> -->

        <t t-if="not (env.context.get('proforma', False) or is_pro_forma)">
                    <span t-if="doc.state not in ['draft','sent']">طلب # </span>
                    <span t-if="doc.state in ['draft','sent']">عرض طلب  # </span>
                </t>
                <span t-field="doc.name"/>

         <!-- <span t-if="env.context.get('proforma', False) or is_pro_forma" style="font-size: 25px;">Pro-Forma Invoice # </span>
                <span t-elif="doc.state in ['draft','sent']" style="font-size: 25px;"> عرض طلب # </span>
                <span t-else="" style="font-size: 25px;">طلب # </span>
                <span t-field="doc.name" style="font-size: 25px;"></span> -->
                
    </xpath>



     <xpath expr="//div[ @id='informations']/div[last()]" position="replace">
        <!-- <div class="col-auto col-3 mw-100 mb-2" style="float: left;">
            
            <strong>البائع:</strong>
            <p t-field="doc.user_id"/>
        </div> -->
        <style>
                    body {
                        direction: rtl;
                    }
                </style>
        <div t-if="doc.user_id.name" class="col-auto col-3 mw-100 mb-2">
                    <strong>البائع</strong>
                    <p class="m-0" t-field="doc.user_id"/>
                </div>
    </xpath>
        


     <xpath expr="//div[@id='informations']/div[position()=2]" position="replace">
        <!-- <div style="direction: rtl; display: flex; align-items: center;">
        <strong t-if="doc.state in ['draft', 'sent']" style="font-size: 20px; margin-right: 10px;">تاريخ الطلب</strong>
        <strong t-else="" style="font-size: 20px; margin-right: 10px;" >تاريخ الفاتورة</strong>
        <p t-field="doc.date_order" t-options='{"widget": "date"}' style="font-size: 20px;"/> 
    </div> -->
        <style>
                    body {
                        direction: rtl;
                    }
                </style>

    <div t-if="doc.date_order and doc.state not in ['draft','sent']" class="col-auto col-3 mw-100 mb-2">
                    <strong>تاريخ الفاتورة</strong>
                    <p class="m-0" t-field="doc.date_order"/>
                </div>
    </xpath>

<!-- table table-sm o_main_table -->

    <xpath expr="//table[@class='table table-sm o_main_table']/thead/tr" position="replace">
          <style>
            body {
                direction: rtl;

            }

            th.text-end {
            text-align: right;
            font-weight: normal;
            font-size: 20px;
        }
        </style>

        <th class="text-end"  > الوصف </th>
        <th class="text-end" > الكمية </th>
        <th class="text-end" >الوحده</th>
        <th class="text-end" >  </th>
        <th class="text-end" >سعر الوحده</th>
        <th class="text-end" > الضرائب</th>
        <th name="th_subtotal" class="text-end" style="font-size: 20px;">
            <span groups="account.group_show_line_subtotals_tax_excluded">المبلغ</span>
            <span groups="account.group_show_line_subtotals_tax_included">المجموع</span>
        </th>
        
    </xpath>
    
    <xpath expr="//table[@class='table table-sm o_main_table']/tbody" position="replace">
        <style>
            body {
                direction: rtl;
            }

            td.text-end {
            text-align: right;
            font-weight: normal;
            font-size: 20px;
        }
        </style>
        <!-- <tr t-foreach="doc.order_line" t-as="line">
            <td t-if="not line.display_type" name="td_name" class="text-end">
                <span t-field="line.name" style="font-size: 18px;"/>
            </td>
            <td t-if="not line.display_type" name="td_quantity" class="text-end">
                <span t-field="line.product_uom" style="font-size:18;"/>
                <span t-field="line.product_uom_qty" style="font-size: 18px;"/>
            </td>
            <td class="text-end">
                <span t-esc="line.uom_per_unit_text" style="font-size: 18px;"/>
            </td>
            <td class="text-end">
                <span t-esc="line.total_text" style="font-size: 18px;"/>
            </td>
            <td t-if="not line.display_type" name="td_priceunit" class="text-end">
                <span t-field="line.price_unit" style="font-size: 18px;"/>
            </td>
            <td t-if="display_discount" class="text-end">
                <span t-field="line.discount" style="font-size: 18px;" />
            </td>
            <td name="td_taxes" class="text-end">
                <span t-out="', '.join(map(lambda x: (x.description or x.name), line.tax_id))" style="font-size: 18px;"/>
            </td>
            <td t-if="not line.is_downpayment" name="td_subtotal" class="text-end o_price_total">
                <span t-field="line.price_subtotal" groups="account.group_show_line_subtotals_tax_excluded" style="font-size: 18px;"/>
                <span t-field="line.price_total" groups="account.group_show_line_subtotals_tax_included" style="font-size: 18px;"/>
            </td>
            
        </tr> -->


        <t t-set="current_subtotal" t-value="0"/>

                    <t t-foreach="doc.order_line" t-as="line">

                        <t t-set="current_subtotal" t-value="current_subtotal + line.price_subtotal" groups="account.group_show_line_subtotals_tax_excluded"/>
                        <t t-set="current_subtotal" t-value="current_subtotal + line.price_total" groups="account.group_show_line_subtotals_tax_included"/>

                        <tr t-att-class="'bg-200 font-weight-bold o_line_section' if line.display_type == 'line_section' else 'font-italic o_line_note' if line.display_type == 'line_note' else ''">
                            <t t-if="not line.display_type">
                                <td name="td_name" class="text-end"><span t-field="line.name"/></td>

                                <td name="td_quantity" class="text-end">
                                    <span t-field="line.product_uom_qty"/>
                                    <span t-field="line.product_uom"/>
                                </td>
                                <td class="text-end">
                                    <span t-esc="line.uom_per_unit_text" style="font-size: 18px;"/>
                                </td>
                                <td class="text-end">
                                    <span t-esc="line.total_text" style="font-size: 18px;"/>
                                </td>
                                <td name="td_priceunit" class="text-end">
                                    <span t-field="line.price_unit"/>
                                </td>
                                <td t-if="display_discount" class="text-end" groups="product.group_discount_per_so_line">
                                    <span t-field="line.discount"/>
                                </td>
                                <td name="td_taxes" class="text-end">
                                    <span t-esc="', '.join(map(lambda x: (x.description or x.name), line.tax_id))"/>
                                </td>
                                <td name="td_subtotal"  class="text-right o_price_total">
                                    <span t-field="line.price_subtotal" groups="account.group_show_line_subtotals_tax_excluded"/>
                                    <span t-field="line.price_total" groups="account.group_show_line_subtotals_tax_included"/>
                                </td>
                            </t>
                            <t t-if="line.display_type == 'line_section'">
                                <td name="td_section_line" colspan="99">
                                    <span t-field="line.name"/>
                                </td>
                                <t t-set="current_section" t-value="line"/>
                                <t t-set="current_subtotal" t-value="0"/>
                            </t>
                            <t t-if="line.display_type == 'line_note'">
                                <td name="td_note_line" colspan="99">
                                    <span t-field="line.name"/>
                                </td>
                            </t>
                        </tr>

                        <t t-if="current_section and (line_last or doc.order_line[line_index+1].display_type == 'line_section')">
                            <tr class="is-subtotal text-right">
                                <td name="td_section_subtotal" colspan="99">
                                    <strong class="mr16">Subtotal</strong>
                                    <span
                                        t-esc="current_subtotal"
                                        t-options='{"widget": "monetary", "display_currency": doc.pricelist_id.currency_id}'
                                    />
                                </td>
                            </tr>
                        </t>    
                    </t>    
                    
    </xpath>
     

</template>



<template id="custom_report_for_tax" inherit_id="account.document_tax_totals">

     <xpath expr="//tr[@class='border-black o_total']" position="replace">
        <style>
            body {
                direction: rtl;
            }

             td.text-end {
            text-align: right;
            font-weight: normal;
            font-size: 20px;
        }
        </style>
        <tr class="border-black o_total">
                <td><strong>المجموع الكلي</strong></td>
                <td class="text-start">
                    <span t-esc="tax_totals['formatted_amount_total']"/>
                </td>
            </tr>
    </xpath>   





     <xpath expr="//tr[@class='border-black o_subtotal']" position="replace">
      <style>
            body {
                direction: rtl;
            }
        </style>
        <tr class="border-black o_subtotal">
            <td style="font-size: 20px;">الاجمالى بدون ضريبه</td>

                    <td class="text-start">
                        <span
                            t-att-class="oe_subtotal_footer_separator"
                            t-esc="subtotal['formatted_amount']"
                        />
                    </td>
        </tr>
    </xpath>
</template> 


<template id='taxes_inhertied_group' inherit_id='account.tax_groups_totals'>
    <xpath expr="//td[.//span[contains(., 'on')]]" position="replace">
         <td class="text_start">
            <span t-esc="amount_by_group['tax_group_name']"/>
            <span class="text-nowrap"> علي
                <t t-esc="amount_by_group['formatted_tax_group_base_amount']"/>
            </span>
        </td>
       
    </xpath>


        <xpath expr="//td[@class='text-right o_price_total']" position="replace">

        <td class="text-start o_price_total">
            <span class="text-nowrap" t-esc="amount_by_group['formatted_tax_group_amount']"/>
        </td>
        </xpath>

</template>

</odoo>
