<?xml version="1.0" encoding="UTF-8"?>
<odoo >
<template id="purchase_order_report_inherit" inherit_id="purchase.report_purchaseorder_document" >

    <xpath expr="//div[@class='mt-4']" position="replace">
        <style>
            body {
                direction: rtl;
            }
        </style>
                <h2 t-if="o.state in ['draft', 'sent', 'to approve']">طلب عرض السعر #<span t-field="o.name"/></h2>
                <h2 t-if="o.state in ['purchase', 'done']">فاتورة شراء #<span t-field="o.name"/></h2>
                <h2 t-if="o.state == 'cancel'">فاتورهشراء ملغاه #<span t-field="o.name"/></h2>
                
    </xpath>

    


    <xpath expr="//div[@class='row mt-4 mb32' and @id='informations']" position="replace">
        

        <div id="informations" class="row mt-4 mb32">
                <div t-if="o.user_id" class="col-3 bm-2">
                    <strong>مندوب شراء:</strong>
                    <p t-field="o.user_id" class="m-0"/>
                </div>
                <div t-if="o.partner_ref" class="col-3 bm-2">
                    <strong>مرجع طلبك:</strong>
                    <p t-field="o.partner_ref" class="m-0"/>
                </div>
                <div t-if="o.state in ['purchase','done'] and o.date_approve" class="col-3 bm-2">
                    <strong>تاريخ الطلب:</strong>
                    <p t-field="o.date_approve" class="m-0"/>
                </div>
                <div t-elif="o.date_order" class="col-3 bm-2">
                    <strong >الموعد النهائي للطلب:</strong>
                    <p t-field="o.date_order" class="m-0"/>
                </div>
            </div>
    </xpath>
        


     

    <xpath expr="//table[@class='table table-sm o_main_table table-borderless mt-4']/thead/tr" position="replace">
          <style>
            body {
                direction: rtl;
            }
        </style>

        <th name="th_description"><strong>الوصف</strong></th>
            <th name="th_uom_per_unit"><strong>الوحده</strong></th>
            <th>  </th>
            <th class="text-end" style="font-weight: normal; font-size: 20px;">  الوحده الفرعيه</th>
            <th class="text-end" style="font-weight: normal; font-size: 20px;">  </th>
            <th name="th_date_req" class="text-center"><strong>تاريخ</strong></th>
            <th name="th_taxes"><strong>الضريبة</strong></th>
            <th name="th_quantity" class="text-end"><strong>كمية</strong></th>
            <th name="th_price_unit" class="text-end"><strong>سعر الوحده</strong></th>
            <th name="th_amount" class="text-end"><strong>الاجمالى</strong></th>
        
    </xpath>
    
    <xpath expr="//table[@class='table table-sm o_main_table table-borderless mt-4']/tbody" position="replace">
        <style>
            body {
                direction: rtl;
            }
        </style>
        <t t-set="current_subtotal" t-value="0"/>
                    <t t-foreach="o.order_line" t-as="line">
                        <t t-set="current_subtotal" t-value="current_subtotal + line.price_subtotal" groups="account.group_show_line_subtotals_tax_excluded"/>
                        <t t-set="current_subtotal" t-value="current_subtotal + line.price_total" groups="account.group_show_line_subtotals_tax_included"/>

                        <tr t-att-class="'bg-200 fw-bold o_line_section' if line.display_type == 'line_section' else 'fst-italic o_line_note' if line.display_type == 'line_note' else ''">
                            <t t-if="not line.display_type">
                                <td id="product">
                                    <span t-field="line.name"/>
                                </td>
                                 <td class="text-center">
                                    <span t-field="line.uom_per_unit"/>
                                </td>
                                 <td class="text-center">
                                    <span t-field="line.carton_text"/>
                                </td>
                                <td class="text-center">
                                    <span t-field="line.total"/>
                                </td>
                                 <td class="text-center">
                                    <span t-field="line.tiles_text"/>
                                </td>
                                 <td class="text-center">
                                    <span t-field="line.date_planned"/>
                                </td>
                                <td name="td_taxes">
                                    <span t-esc="', '.join(map(lambda x: x.description or x.name, line.taxes_id))"/>
                                </td>
                                <td class="text-end">
                                    <span t-field="line.product_qty"/>
                                    <span t-field="line.product_uom.name" groups="uom.group_uom"/>
                                </td>
                                <td class="text-end">
                                    <span t-field="line.price_unit"/>
                                </td>
                                <td class="text-end">
                                    <span t-field="line.price_subtotal"
                                        t-options='{"widget": "monetary", "display_currency": o.currency_id}'/>
                                </td>
                            </t>
                            <t t-if="line.display_type == 'line_section'">
                                <td colspan="99" id="section">
                                    <span t-field="line.name"/>
                                </td>
                                <t t-set="current_section" t-value="line"/>
                                <t t-set="current_subtotal" t-value="0"/>
                            </t>
                            <t t-if="line.display_type == 'line_note'">
                                <td colspan="99" id="note">
                                    <span t-field="line.name"/>
                                </td>
                            </t>
                        </tr>
                        <t t-if="current_section and (line_last or o.order_line[line_index+1].display_type == 'line_section')">
                            <tr class="is-subtotal text-end">
                                <td colspan="99" id="subtotal">
                                    <strong class="mr16">Subtotal</strong>
                                    <span
                                        t-esc="current_subtotal"
                                        t-options='{"widget": "monetary", "display_currency": o.currency_id}'
                                    />
                                </td>
                            </tr>
                        </t>
                    </t>





        <tr t-foreach="lines_to_report" t-as="line">
            <td t-if="not line.display_type" name="td_name" class="text-end">
                <span t-field="line.name" style="font-size: 18px;"/>
            </td>
            <td t-if="not line.display_type" name="td_quantity" class="text-end">
                <span t-field="line.product_uom" style="font-size:18;"/>
                <span t-field="line.product_uom_qty" style="font-size: 18px;"/>
            </td>
            <td class="text-end">
                <span t-esc="line.uom_per_unit" style="font-size: 18px;"/>
            </td>
            <td class="text-end">
                <span t-esc="line.carton_text" style="font-size: 18px;"/>
            </td>
            <td class="text-end">
                <span t-esc="line.total" style="font-size: 18px;"/>
            </td>
            <td class="text-end">
                <span t-esc="line.tiles_text" style="font-size: 18px;"/>
            </td>
            <td t-if="not line.display_type" name="td_priceunit" class="text-end">
                <span t-field="line.price_unit" style="font-size: 18px;"/>
            </td>
            <td t-if="display_discount" class="text-end">
                <span t-field="line.discount" style="font-size: 18px;" />
            </td>  
            
            
        </tr>
   </xpath> 
    

</template>



</odoo>
